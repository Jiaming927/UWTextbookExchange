<!DOCTYPE html>
<html lang="en">
<head>
	<title>Tebook</title>
	<link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/simplex/bootstrap.min.css" rel="stylesheet">
	<%= stylesheet_link_tag('commonbg', :media => 'all') %>
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<%= csrf_meta_tags %>
<style>
#toplink {
	margin-top:50px;
	font-size: 1.2em;
	font-weight: bold;
}

h2, h3 {
	margin-top: 5px;
	margin-bottom: 5px;
	padding-left: 5px;
}
.postlink {
	font-size: 1.2em;
	padding: 5px;
	vertical-align: middle;
	font-weight: bold;
}
.option {
	margin: 10px;
	clear:both;
}
.users {
	margin: 5px;
	float: left;
	padding-right: 10px;
}
.notice {
	margin-bottom: 10px;
	border-radius: 5px;
	padding: 5px;
	border: 1px red solid;
	background-color: #ff9999;
	text-align: center;
	color: black;
	font-weight: bold;
}
</style>
</head>

<body>
	<%= render template: "layouts/bar" %>
	<div style="width:90%;margin:auto">
		<div id="toplink">
			<%= link_to("Home", root_url) %>
			<a href="javascript:history.back(-1)">Back </a>
		</div>
		<h2>Details</h2>
		<% if !flash[:notice].blank? %>
			<div class = "notice">
				<%= flash[:notice] %>
			</div>
		<% end %>
		<% if @bookinfo.number > 0 %>
			<div class="option"><%=@bookinfo.book_title %></div>
			<div class="option">
				<% if @bookinfo.course_name.split(',').count > 1 %>
					Courses: 
				<% else %>
					Course:
				<% end %>

				<% @bookinfo.course_name.split(',').each do |course| %>
					<a href="<%=root_url%>find?coursename=<%=course%>"><%=course%></a>
				<% end %>
			</div>
			<% if user_signed_in? %>
				<div class="postlink"><a href="<%=root_url%>postto?from=show&book=<%=@bookinfo.book_title%>">Post</a></div>
			<% else %>
				<div class="postlink"><%=link_to('Sign in', new_session_path(resource_name)) %> to post this book</div>
			<% end %>
			<% if @bookinfo.number == 1 %>
				<% has = 'has' %>
			<% else %>
				<% has = 'have' %>
			<% end %>
					<h3><%= pluralize(@bookinfo.number, 'person') %> <%= has %> the book</h3>
			<% if user_signed_in? %>
				<span class="users">
					<% @book.each do |bk| %>
						<% if bk.username != current_user.username%>
							<% if bk.msgcount.last_update > 2.minutes.ago %>
								<%= image_tag('online.png', size:"12x12") %>
							<% else %>
								<%= image_tag('offline.png', size:"12x12") %>
							<% end %>
							<a href="<%=root_url%>chat?receiver=<%=bk.username%>"><%=bk.username%></a>
						<% end %>			
					<% end %>
				</span>
			<% else %>
				<div><%=link_to('Sign in', new_session_path(resource_name)) %> or <%=link_to('Sign up', new_registration_path(resource_name)) %> to see who has it.</div>
			<% end %>
		<% else %>
			<h1><%=@bookinfo.book_title%></h1>
			<div>Sorry, no one has posted this book yet.</div>
			<% if !user_signed_in? %>
				<div><%=link_to('Sign in', new_session_path(resource_name)) %> or <%=link_to('Sign up', new_registration_path(resource_name)) %> to post it.</div>
			<% else %>
				<div>Do you want to <a href="<%=root_url%>postto?book=<%=@bookinfo.book_title%>">post</a> it?</div>
			<% end %>
		<% end %>
	</div>
</body>
</html>