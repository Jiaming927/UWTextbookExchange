<script>
$( document ).ready(function(){
	
	$("#loading")[0].hidden = "hidden";
	$("#new_message").submit(function() {
		if ($("#message_content")[0].value.trim() != ""){
			$("#loading")[0].hidden = null;
		} else {
			$("#message_content")[0].value = "";
		}
	});
});
</script>

<%= link_to("Home", root_url) %>
<a href="javascript:history.back(-1)">Back </a>

<h1>Chat with <%=params[:receiver].strip%></h1>
<div>Log in as <%=current_user.username%></div>
<br />
<ul id="chat">
  <%= render @messages %>
</ul>

<%= form_for Message.new, :remote => true do |f| %>
<div>
  <%= f.text_field :content %>
  <%= f.hidden_field :sender, :value => current_user.username %>
  <%= f.hidden_field :receiver, :value => params[:receiver].strip %>
  <%= f.submit "Send"%>
  <%= image_tag('loading.gif', id: 'loading', size:"20x20") %>
</div>
<% end %>
<%= subscribe_to "/messages/" + @channel %>
